# -*- coding: utf-8 -*-
"""Loan Approval Prediction with Machine Learning.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14UpZcosP7D8C6ciMcR6R7NQrHFGdEDFG
"""

import pandas as pd
from sklearn.preprocessing import LabelEncoder

# 1. Load data
df = pd.read_csv('loan_prediction.csv')

# 2. Fill Missing Values
# Categorical (fill with the most frequent value)
df['Gender'].fillna(df['Gender'].mode()[0], inplace=True)
df['Married'].fillna(df['Married'].mode()[0], inplace=True)
df['Dependents'].fillna(df['Dependents'].mode()[0], inplace=True)
df['Self_Employed'].fillna(df['Self_Employed'].mode()[0], inplace=True)
df['Credit_History'].fillna(df['Credit_History'].mode()[0], inplace=True)

# Numerical (fill with the middle value)
df['LoanAmount'].fillna(df['LoanAmount'].median(), inplace=True)
df['Loan_Amount_Term'].fillna(df['Loan_Amount_Term'].mode()[0], inplace=True)

# 3. Convert Words to Numbers
le = LabelEncoder()
categorical_cols = ['Gender', 'Married', 'Education', 'Self_Employed', 'Property_Area', 'Loan_Status', 'Dependents']

for col in categorical_cols:
    df[col] = le.fit_transform(df[col])

# Drop Loan_ID as it doesn't help with prediction
df.drop('Loan_ID', axis=1, inplace=True)

print("Data cleaning and encoding complete!")
df.head()

from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, classification_report

# 1. Split Features and Target
X = df.drop('Loan_Status', axis=1)
y = df['Loan_Status']

# 2. Split into Training and Testing
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 3. Train the Model
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# 4. Predict
y_pred = model.predict(X_test)

print(f"Loan Prediction Accuracy: {accuracy_score(y_test, y_pred)*100:.2f}%")

import matplotlib.pyplot as plt
import seaborn as sns

importances = pd.Series(model.feature_importances_, index=X.columns)
importances.sort_values().plot(kind='barh', color='teal')
plt.title('Most Important Factors for Loan Approval')
plt.show()

# Format: [Gender, Married, Dependents, Education, Self_Employed, ApplicantIncome, CoapplicantIncome, LoanAmount, Loan_Amount_Term, Credit_History, Property_Area]
# Example: Male (1), Married (1), 0 Dependents (0), Graduate (0), Not Self-Employed (0), Income 5000, Co-Income 0, Amount 150, Term 360, Credit History 1.0, Urban (2)
new_applicant = [[1, 1, 0, 0, 0, 5000, 0, 150, 360, 1.0, 2]]
prediction = model.predict(new_applicant)

if prediction[0] == 1:
    print("Decision: LOAN APPROVED")
else:
    print("Decision: LOAN REJECTED")